#!/bin/bash
# Bash —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Lobe Chat –ª–æ–∫–∞–ª—å–Ω–æ
# –î–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–∑ Git Bash: ./start-local.sh

set -e

echo "üöÄ –ó–∞–ø—É—Å–∫ Lobe Chat –ª–æ–∫–∞–ª—å–Ω–æ..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å pnpm
if ! command -v pnpm &> /dev/null; then
    echo "‚ùå pnpm –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º..."
    corepack enable
    corepack prepare pnpm@latest --activate
fi

# –û—á–∏—â–∞–µ–º –∫—ç—à –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º
echo "üßπ –û—á–∏—â–∞–µ–º –∫—ç—à..."
rm -rf .next
rm -rf node_modules/.cache

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
if [ ! -d "node_modules" ]; then
    echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
    pnpm install
fi

# –ü–æ–ª—É—á–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π IP –∞–¥—Ä–µ—Å (Windows)
LOCAL_IP=$(ipconfig | grep -A 4 "Ethernet adapter" | grep "IPv4" | head -1 | cut -d ":" -f 2 | tr -d " " || echo "192.168.1.x")

echo "üåê –°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å–∞–º:"
echo "   - –õ–æ–∫–∞–ª—å–Ω–æ: http://localhost:3010"
echo "   - –ò–∑ —Å–µ—Ç–∏: http://$LOCAL_IP:3010"

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export HOSTNAME="0.0.0.0"
export PORT="3010"

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
echo "üéØ –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä..."
pnpm dev --hostname 0.0.0.0 --port 3010
